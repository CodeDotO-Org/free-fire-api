import puppeteer from "puppeteer-core";

const URL = "https://shop.garena.my/?app=100067&item=44111&channel=202070";
const BROWSER_WS = "wss://brd-customer-hl_3dd67c2f-zone-scraping_browser3:d0rn962m904g@brd.superproxy.io:9222";

run(URL);

async function run(url) {
  console.log("Connecting to browser...");
  const browser = await puppeteer.connect({
    browserWSEndpoint: BROWSER_WS,
  });
  console.log("Connected! Navigate to site...");
  const page = await browser.newPage();
  await page.goto(url, { waitUntil: "domcontentloaded", timeout: 60000 });

   await delay(2000);

  // Handle OK button
    const okButtonClicked = await clickButtonByText(page, 'OK');
    if (!okButtonClicked) console.log('OK button not found.');

    // Fill user ID
    const loginInputSelector = 'input[placeholder="Please enter player ID here"]';
    await page.waitForSelector(loginInputSelector, { timeout: 5000 });
    await page.type(loginInputSelector, '9736578480', { delay: 100 });
    console.log('User ID entered successfully.');

    // Click "Login" button
    await clickButtonByText(page, 'Login');
    console.log('Login button clicked.');

   await delay(10000);

  await browser.close();
}

// Helper function for delay
const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

// Helper function to click a button by its text
const clickButtonByText = async (page, text) => {
  const buttons = await page.$$('button');
  for (const button of buttons) {
    const buttonText = await page.evaluate((btn) => btn.textContent.trim(), button);
    if (buttonText === text) {
      await button.click();
      return true;
    }
  }
  return false;
};